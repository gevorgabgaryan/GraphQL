https://www.apollographql.com/docs/apollo-server
1. npm i @apollo/server graphql

resolvers/index.js

const resolvers = {
    Query: {
      hello: () => 'Hello world',
    },
  };

export default resolvers;



schemas/index.js


import { buildSchema } from "graphql";

const schemas = buildSchema(`
    type Query {
        hello: String
    }
`)

export default schemas;


API/index.js

import { ApolloServer } from '@apollo/server';
import { expressMiddleware } from '@apollo/server/express4';
import { ApolloServerPluginDrainHttpServer } from '@apollo/server/plugin/drainHttpServer'
import schemas from '../schemas';
import resolvers from '../resolvers';

// Set up Apollo Server
const server = new ApolloServer({
  typeDefs: schemas,
  resolvers,
  plugins: [ApolloServerPluginDrainHttpServer({ httpServer })],
});
await server.start();

app.use(
  expressMiddleware(server),
);

index.js

http://localhost:8000/graphql

query {
  hello
}


2. Get users
resolvers/index.js

import UserModel from "../models/UserModel";

const resolvers = {
    Query: {
      users: async () => {
         try{
            return await UserModel.find();
         } catch(e) {
            throw e;
         }
      },
    },
  };

export default resolvers;


schemas/index.js

import { buildSchema } from "graphql";

const schemas = buildSchema(`
    type User {
        id: String!
        firstName: String!
        lastName: String!
        role: String!
        status: String!
        email: String!
    }

    type Query {
        users: [User]
    }
`)

export default schemas;

frontend

http://localhost:8000/graphql

query {
  users {
    id
    firstName
  }
}

3. get user

resolvers Query

    user: async (_, {id}) => {
         try{
            return await UserModel.findOne({_id: id});
         } catch(e) {
            throw e;
         }
      },

 schemas Query

 user(id: ID): User

frontend

query user($userId: ID) {
  user(id: $userId) {
    email
  }
}

{
  "userId": "660f9bafb11e2b0393819221"
}

4. Register

resolvers

    Mutation : {
      regUser: async (_, {input}) => {
          try {
              const user = await UserModel.findOne({email: input.email});
              if (user) throw new Error('User already exists');
              const newUser = await UserModel.create({
                  firstName: input.firstName,
                  lastName: input.lastName,
                  email: input.email,
                  role: 'user',
                  status: "active",
                  password: input.password
              })

              newUser.id = newUser._id;
              return newUser;
          } catch (error) {
              throw error;
          }
      },
   }

schema

 input UserInput {
      id: ID
      firstName: String
      lastName: String
      role: String
      status: String
      email: String!
      password: String!
  }


 type Mutation {
    regUser(input: UserInput!): User!
 }

 Frontend Query

mutation RegUser($input: UserInput!) {
  regUser(input: $input) {
    id
    firstName
    lastName
    role
    status
    email
  }
}

{
  "input": {
    "email": "gevorg@gmail.com",
    "password": "Ga123456"
  }
}


5. Login

resolvers Mutation

import jwt from 'jsonwebtoken'
import config from "../config";

   loginUser: async (_, { email, password }) => {
         const user = await UserModel.findOne({ email });
         if (!user) throw new Error('User not found');
         const isValid = await user.comparePassword(password);
         if (!isValid) throw new Error('Invalid password');
         const token = jwt.sign({ userId: user.id, role: user.role }, config.JWTSecret, { expiresIn: '1d' });
         return { token, user };
      },



schemas Mutation

    loginUser(email: String!, password: String!): AuthPayload!

    type AuthPayload {
        token: String!
        user: User!
    }

    loginUser(email: String!, password: String!): AuthPayload!

 frontend

 mutation LoginUser($email: String!, $password: String!) {
  loginUser(email: $email, password: $password) {
    token
  }
}

{
  "email": "gevorg2@gmail.com",
  "password": "Ga123456"
}

6. Edit User

   resolvers Mutation

      editUser: async (_, args, context) => {
         if (!context.user || !context.user.userId) throw new Error('UnAuthorized');
         const updatedUser = await UserModel.findByIdAndUpdate(context.user.userId, args.input, { new: true });
         return updatedUser;
      },
  schema Mutation

  input EditUserInput {
        firstName: String
        lastName: String
        password: String
  }


  editUser(input: EditUserInput!): User


  API.js


   app.use(
    expressMiddleware(server, {
      context: async ({ req }) => ({
          user: req.user,
      }),
    })
   );

   frontend

mutation EditUser($input: EditUserInput!) {
  editUser(input: $input) {
    id
    firstName
    lastName
    role
    status
    email
  }
}

{
   "input": {
     "lastName": "GGG"
   }
}